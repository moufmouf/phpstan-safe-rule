language: php
sudo: false
jobs:
  include:
    - php: 7.4
      env: COMPOSER_ARG=""
      before_script:
        - &composerupdate
            composer update --no-interaction --no-progress --optimize-autoloader $COMPOSER_ARG
      script:
        - &phpunit
            "./vendor/bin/phpunit"
        - composer phpstan
        - composer cs-check
      after_script:
        - travis_retry php vendor/bin/php-coveralls -v
    - php: 7.1
      env: COMPOSER_ARG=""
      before_script:
        - *composerupdate
      script:
        - *phpunit
    - php: 7.1
      env: COMPOSER_ARG="--prefer-lowest"
      before_script:
        - *composerupdate
      script:
        - *phpunit
    - php: nightly 
      env: COMPOSER_ARG="--ignore-platform-reqs"
      before_script:
        - *composerupdate
      script:
        - *phpunit

cache:
  directories:
  - "$HOME/.composer/cache"
after_success:
- vendor/bin/coveralls -v
